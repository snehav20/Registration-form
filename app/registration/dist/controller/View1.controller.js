sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,s){"use strict";return e.extend("registration.controller.View1",{onInit:function(){this.getView().setModel(new t({student:{firstName:"",lastName:"",dob:"",gender:"",grade:""},parent:{fatherName:"",motherName:"",mobile:"",address:""},fees:{feeType:"",amount:"",paymentStatus:"",receipts:[]},uploadBusy:false,showStep2:false,showStep3:false,showPreview:false,showSubmit:false}),"wizard")},onStudentChange:function(){const e=this.getView().getModel("wizard").getProperty("/student");this.getView().getModel("wizard").setProperty("/showStep2",!!e.firstName&&!!e.dob&&!!e.gender)},onStudentNext:function(){this.byId("studentStep").setValidated(true);this.byId("registrationWizard").nextStep()},onParentChange:function(e){const t=this.getView().getModel("wizard");const s=e.getSource().getBindingInfo("value").binding.getPath();t.setProperty("/parent/"+s.split("/").pop(),e.getParameter("value"));const a=t.getProperty("/parent");t.setProperty("/showStep3",a.fatherName&&a.motherName&&/^\d{10}$/.test(a.mobile))},onParentNext:function(){this.byId("parentStep").setValidated(true);this.byId("registrationWizard").nextStep()},onFeesChange:function(){var e=this.getView().getModel("wizard");var t=e.getProperty("/fees");var s=!!t.feeType&&!!t.amount&&!!t.paymentStatus&&t.receipts.length>0;e.setProperty("/showPreview",s)},onFeesNext:function(){var e=this.byId("registrationWizard");var t=this.getView().getModel("wizard");e.validateStep(this.byId("feesStep"));t.setProperty("/showSubmit",true);e.setCurrentStep(this.byId("previewStep"))},onReceiptChange:function(e){const t=this.getView().getModel("wizard");t.setProperty("/uploadBusy",true);const s=e.getSource().getDomRef("fu").files;const a=t.getProperty("/fees/receipts");setTimeout(()=>{Array.from(s).forEach(e=>a.push({fileName:e.name,url:URL.createObjectURL(e)}));t.setProperty("/fees/receipts",a);e.getSource().setValue("");t.setProperty("/uploadBusy",false);this.onFeesChange()},600)},onPreviewReceipt:function(e){const t=e.getSource().getParent().getParent();const s=t.getBindingContext("wizard");const a=s.getProperty("url");if(a){window.open(a,"_blank")}else{sap.m.MessageToast.show("No file to preview!")}},onDeleteReceipt:function(e){const t=e.getSource().indexOfItem(e.getParameter("listItem"));const s=this.getView().getModel("wizard");const a=s.getProperty("/fees/receipts");a.splice(t,1);s.setProperty("/fees/receipts",a);this.onFeesChange()},onSaveDraftPress:function(){this.onSaveDraft(false)},onSaveDraft:async function(e){const t=this.getOwnerComponent().getModel();const s=this.getView().getModel("wizard").getData();try{const a=t.bindList("/Parents");const o=a.create({FatherName:s.parent.fatherName,MotherName:s.parent.motherName,MobileNumber:s.parent.mobile,Address:s.parent.address});await o.created();const r=t.bindList("ParentstoStudents",o);const n=r.create({FirstName:s.student.firstName,LastName:s.student.lastName,DateOfBirth:s.student.dob,Gender:s.student.gender,Grade:s.student.grade});await n.created();const i=t.bindList("StudentstoFees",n);for(const e of s.fees.receipts||[]){await i.create({FeeType:s.fees.feeType,Amount:s.fees.amount,PaymentStatus:s.fees.paymentStatus,Receipts:e.fileName}).created()}this.getView().setBindingContext(o);if(!e){sap.m.MessageBox.information("Draft saved successfully")}}catch(e){console.error(e);sap.m.MessageBox.error("Draft save failed")}},onSubmit:async function(){const e=this.getView();const t=this.getOwnerComponent().getModel();let s=e.getBindingContext();try{if(s&&s.getProperty("IsActiveEntity")===false){await s.getModel().bindContext(s.getPath()+"/My.draftActivate(...)").execute();sap.m.MessageBox.confirm("Do you want to confirm Registration ",{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(){t.refresh();const s=this.byId("registrationWizard");const a=e.getModel("wizard");this.getView().setBindingContext(null);a.setData({student:{firstName:"",lastName:"",dob:"",gender:"",grade:""},parent:{fatherName:"",motherName:"",mobile:"",address:""},fees:{feeType:"",amount:"",paymentStatus:"",receipts:[]},showStep2:false,showStep3:false,showPreview:false,showSubmit:false});s.discardProgress(this.byId("studentStep"));s.goToStep(this.byId("studentStep"))}.bind(this)});return}await this.onSaveDraft(true);s=e.getBindingContext();await s.getModel().bindContext(s.getPath()+"/My.draftActivate(...)").execute();sap.m.MessageBox.success("Registration submitted successfully",{onClose:()=>{t.refresh();this._resetWizard()}});const a=this.byId("registrationWizard");const o=e.getModel("wizard");this.getView().setBindingContext(null);o.setData({student:{firstName:"",lastName:"",dob:"",gender:"",grade:""},parent:{fatherName:"",motherName:"",mobile:"",address:""},fees:{feeType:"",amount:"",paymentStatus:"",receipts:[]},showStep2:false,showStep3:false,showPreview:false,showSubmit:false});a.discardProgress(this.byId("studentStep"));a.goToStep(this.byId("studentStep"))}catch(e){console.error(e);sap.m.MessageBox.error(e.message||"Submit failed")}}})});
//# sourceMappingURL=View1.controller.js.map